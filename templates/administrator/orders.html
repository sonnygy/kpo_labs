{% extends 'base.html' %}
{% load static %}

{% block title %}Заказы — Сервис ремонта техники{% endblock %}

{% block navigation %}
    {% include 'nav/nav_administrator.html' %}
{% endblock %}

{% block styles %}
<link rel="stylesheet" href="{% static 'css/tables.css' %}">
{% endblock %}

{% block content %}
<div class="table-container">
    <h2>Все заявки на ремонт</h2>

    {% if orders %}
    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>Клиент</th>
                <th>Мастер</th>
                <th>Статус</th>
                <th>Дата создания</th>
                <th>Дата завершения</th>
                <th>Назначение</th>
            </tr>
        </thead>

        <tbody>
        {% for order in orders %}
            <tr class="{% if not order.master %}no-master{% endif %}">
                <td>{{ order.id }}</td>

                <td>{{ order.client.fill_name }}</td>

                <td>
                    {% if order.master %}
                        {{ order.master.fill_name }}
                    {% else %}
                        <em>Не назначен</em>
                    {% endif %}
                </td>

                <td>
                    <span class="status {{ order.status }}">
                        {{ order.get_status_display }}
                    </span>
                </td>

                <td>{{ order.created_at|date:"d.m.Y H:i" }}</td>

                <td>
                    {% if order.completed_at %}
                        {{ order.completed_at|date:"d.m.Y H:i" }}
                    {% else %}
                        —
                    {% endif %}
                </td>

                <td>
                    <form method="post"
                          action="{% url 'order_assign_master' order.id %}"
                          class="assign-form">
                        {% csrf_token %}

                        <select name="master">
                            <option value="">— не назначен —</option>
                            {% for master in masters %}
                                <option value="{{ master.id }}"
                                    {% if order.master and order.master.id == master.id %}
                                        selected
                                    {% endif %}
                                >
                                    {{ master.fill_name }}
                                </option>
                            {% endfor %}
                        </select>

                        <button type="submit">
                            Назначить
                        </button>
                    </form>
                </td>
            </tr>
        {% endfor %}
        </tbody>
    </table>

    {% else %}
        <p>Заявок пока нет.</p>
    {% endif %}
</div>
{% endblock %}